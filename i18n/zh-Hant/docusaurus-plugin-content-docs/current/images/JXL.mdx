---
title: JPEG-XL
sidebar_position: 7
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

### JPEG-XL

JPEG-XL（JXL）是一種圖像壓縮格式，由聯合攝影專家組（JPEG）於2020年開發。它旨在提供比傳統的 [JPEG](./JPEG.mdx) 格式更高的壓縮效率，同時保持圖像品質。JPEG-XL 結合了感知色彩編碼、高級熵編碼以及一種新的圖像預測方法來實現其改進的壓縮性能。它還具有無損 JPEG 重新壓縮模式，允許將現有的 JPEG 檔案轉換為 JXL 檔案，從而可以解碼為與原始 JPEG 完全相同的位元組副本。

## 性能檢查表

- **無損？** *是*
- **有損？** *是*
- **支援的位元深度：*
  *最高 32 位元深*
- **HDR/廣色域？** *是*
- **動畫？** *是*
- **透明度？** *是*
- **漸進解碼？** *是*
- **免買斷式授權？** *是*

## 格式特點

JPEG-XL 擁有多項突出特點，使其在許多應用場景中成為一個具有吸引力的圖像編解碼器。根據 [JPEG-XL Info page](https://jpegxl.info) 的介紹，JXL 擁有以下特點：

- **最佳無損圖像壓縮**：提供比 PNG 小約35%的檔案大小（對於 HDR 小約50%）。
- **高保真有損圖像壓縮**：JPEG-XL 在保持相同視覺品質的情況下，比 JPEG 小約60%的檔案大小。
- **漸進解碼**：允許在整個檔案下載完成之前以較低的品質顯示圖像，改善慢速連接下的用戶體驗。
- **無損 JPEG 轉碼**：JPEG 圖像可以無損地轉換為 JPEG-XL，且結果檔案約小20%。
- **設計適用於攝影及合成圖像**：JPEG-XL 能夠良好處理各類圖像，包括照片、圖形和插圖。
- **快速的軟體編碼和解碼**：該編解碼器設計為高效且快速，支援快速的圖像加載和保存。
- **全面支援廣色域和 HDR**：JPEG-XL 支援廣泛的顏色和高動態範圍，使其適用於現代顯示器。
- **感知優化的參考編碼器**：編碼器設計為根據人類對圖像的感知來優化圖像品質。

### 無損壓縮

JPEG-XL 提供了出色的無損壓縮能力。雖然無損 WebP 在 8 位無損圖像編碼方面比 PNG 有所改進，但 JPEG-XL 不僅在編碼效率上超越了無損 WebP，還在超過 8 位的位元深度（這是 PNG 先前主導的範疇）中更具多樣性。16 位的無損圖像，尤其是那些越來越受歡迎且少使用 8 位顏色深度的 HDR 圖像，是 JPEG-XL 的強項。它是唯一能在這方面與 PNG 競爭並提供更好編碼效率的編解碼器。

範例：JPEG-XL 對 [這個 16 位 AdobeRGB PNG](https://imgsaver.com/images/2023/10/03/16bit.png) 的壓縮效果優於 PNG。使用指令：`cjxl 16bit.png 16bit.jxl -d 0.0 -e 9 -I 100 -g 3 -E 11`

16 位 PNG：`1533373` 位元組。
16 位 JXL：`1211029` 位元組。

### 有損壓縮

JPEG-XL 在有損壓縮方面也非常擅長，尤其是在我們人類關心的質量水平上。它的壓縮效果比 JPEG 好約 60%。雖然基於視頻的編解碼器如 AVIF 在給予大量 CPU 時間的情況下可以具有競爭力，但 JPEG-XL 在中高保真度的攝影圖像中既快速又高效。

### 支援的位元深度

JPEG-XL 支援高達 32 位元每通道的位元深度，使其未來可以應對智能手機中越來越受歡迎的 HDR 照片。相對於編碼結果的大小，使用 JXL 編碼高位深圖像幾乎沒有缺點。考慮到許多智能手機現在拍攝 HDR 照片，JXL 為這些照片未來進入網絡提供了一個引人注目的管道，尤其是 Adobe 和 Apple 等公司已經擁抱了這一新編解碼器。

### 漸進解碼

JPEG-XL 提供了實際的漸進解碼支持，你可以在支持的瀏覽器上進行實驗，如 Safari、Waterfox、Thorium、Mercury 或任何 iOS 上的瀏覽器。

漸進解碼是一項只有 JPEG 能夠實現真正實施的功能，它能夠在整個圖像傳送完成之前渲染低頻變換係數，允許圖像在網絡傳送過程中顯示出來。Blurhashes 並不取代這項技術，而是補充它，提供另一層漸進解碼，可以在圖像開始逐步加載之前使用。這是改善大型圖像網站或在網絡連接不強的情況下提高用戶體驗的重要功能。

### 無損 JPEG 重新壓縮

JPEG-XL 的一個非常獨特的功能是無損 JPEG 重新壓縮，即能夠將 JPEG 輸入轉換為更小文件大小（平均小 20%）且像素逐一相同的輸出。這也是為什麼像 Meta 這樣的公司支持 JPEG-XL，因為它為互聯網上的現有 JPEG 提供了一條前進的道路。

### 行業支持

根據 JPEG-XL 維基百科頁面：

> 除了最初的 Cloudinary 和 Google 外，在 JPEG-XL 初步實施於網頁瀏覽器期間，許多知名行業品牌的代表公開表示支持 JPEG-XL 作為他們的首選，包括 Facebook、Adobe、Intel 和視頻電子標準協會、The Guardian、Flickr 和 SmugMug、Shopify、Krita Foundation 和 Serif Ltd。

Apple 也在 iOS 17 和 macOS Sonoma 中全面支援 JPEG-XL。

### 其他特點

JPEG-XL 擁有廣泛的功能集，具有取代 TIFF 等流行格式的潛力，用於創作工作流程。根據 JXL 維基百科的一些附加特性包括：

- Image dimensions of over a billion (2^30-1) pixels on each side.
- Up to 4099 channels, including support for alpha transparency
- There can be multiple frames with zero duration, allowing support for layers in graphics software
- Animation support, allowing JXL to rival GIF
- Images can be stored in tiles to reduce the time needed to decode them.
- Graceful quality degradation across a large range of bitrates means quality loss isn't as abrupt as with older formats.
- Perceptually optimized reference encoder which uses a perceptual color space, adaptive quantization, and conservative default settings.
- Support for wide color gamut and HDR
- Efficient encoding and decoding without requiring specialized hardware: JPEG XL is about as fast to encode and decode as old JPEG using libjpeg-turbo and an order of magnitude faster to encode and decode compared to HEIC with x265. It is also parallelizable.
- Royalty-free format with an open-source reference implementation available on GitHub.

## Encoders

JPEG-XL has a couple of noteworthy encoders currently available to work with. Because JPEG-XL is so new, most encoders aren't yet intelligent enough to take advantage of the whole format yet. Here's a quote from Jon Sneyers in the JPEG-XL discord that sums it up nicely:

> Encode side: 80% or so of the coding tools are used in one way or another by the encoder (the 20% is splines and super large VarDCT blocks, and also the things that are not used by default without using special experimental options, such as delta palette and noise). But the coding tools that are used, are typically used in a specific, limited way that doesn't come anywhere close to exhausting the bitstream expressivity.

Sneyers is talking about libjxl's `cjxl` encoder, which will be discussed further below.

### libjxl

The reference [libjxl](https://github.com/libjxl/libjxl) implementation has the capability to both decode and encode JPEG-XL image files. Both are discussed below.

<Tabs>
    <TabItem value="enc" label="Encoding" default>
        
        libjxl's encoder `cjxl` has more options to play around with. It takes a few primary arguments, distance (`-d`), quality (`-q`), and effort (`-e`).

        **Distance and quality**

        Distance and quality are two ways of specifying *how much loss* you are willing to tolerate, and as such, they are mutually exclusive, as they pull the same levers under the hood.
        * Distance is designed to map to how 'close' one must be to the source to notice any loss. It is represented as a scale between 0.0 & 25.0. 0.0 is **mathematically lossless**, every pixel will have the exact same value as the source. 1.0 is designed to be **visually lossless**, look the same at a normal viewing distance, and higher values have more loss.
        * Quality is designed to roughly map to [JPEG](./JPEG.mdx)'s quality argument. A range 0-100, where 100 is **mathematically lossless**, 90 is intended to be **visually lossless**, and 0 is almost unrecognizable as the original image.

        **Effort**

        Effort is similar to `cpu-used` in video encoding. It specifies the amount of effort the encoder will make in order to get the smallest file size it can. It takes the form of a range 1-9, where higher numbers will spend more resources to get diminishing returns in terms of smaller size, while lower values do the opposite, leaving file size on the table for faster encoding.

        ```bash title="Encoding with effort 9 and distance 1.0"
        cjxl -e 9 -d 1.0 example.png example.jxl
        ```

        ```bash title="This, by default uses lossless JPEG compression."
        cjxl example.jpg example.jxl
        ```

    </TabItem>
    <TabItem value="dec" label="Decoding">
        Decoding a `.jxl` image is straightforward with libjxl's decoder, `djxl`:

        ```bash
        djxl example.jxl example.png
        ```
        `djxl` can decode to pixels via pipes, png, apng for animated jxl, jpg, ppm, and pfm.

        By default, if the `.jxl` file was encoded with lossless jpeg recompression, `djxl` will rebuild the exact jpeg file that was originally compressed. To avoid this, and create a new jpeg file:
        ```bash
        djxl -j example.jxl example.jpg
        ```
        **Keep in mind this is now a lossy process as `djxl` will decode to pixels, then encode a new `.jpg` with those pixels.**
    </TabItem>
    <TabItem value="build" label="Building">
        A full build guide is provided in the [libjxl build instructions](https://github.com/libjxl/libjxl/blob/main/BUILDING.md) in the GitHub repo. This guide is simplified, and is only focused on building a working efficient encoder & decoder.

        These instructions should work for macOS and Linux, although macOS support isn't guaranteed.

        ```bash title="1. Clone the repo"
        git clone https://github.com/libjxl/libjxl.git --recursive --shallow-submodules
        ```

        ```bash title="2. Install dependencies. May have to run these commands with root"
        apt install cmake pkg-config libbrotli-dev clang # Debian Linux
        pacman -Syu cmake pkgconf brotli clang # Arch Linux
        brew install cmake pkg-config brotli # macOS
        ```

        ```bash title="3. Set CC & CXX variables before building (Recommended)"
        export CC=clang CXX=clang++
        ```

        ```bash title="4. cjxl & djxl will be available in the build/tools directory."
        cd libjxl && mkdir build && cd build
        cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-O3 -march=native" -DCMAKE_C_FLAGS="-O3 -march=native" -DBUILD_TESTING=OFF -DJPEGXL_WARNINGS_AS_ERRORS=OFF -DJPEGXL_ENABLE_SJPEG=OFF ..
        cmake --build . -- -j$(nproc)
        ```

        This will build `cjxl` and `djxl` with O3 optimization for your CPU architecture on Linux or macOS. Again, be aware that macOS support is not a priority. Via the libjxl OS X build guide:

        > OSX builds have "best effort" support, i.e. build might not work at all, some tests may fail and some sub-projects are excluded from build.
    </TabItem>
</Tabs>

### libjxl-tiny

[libjxl-tiny](https://github.com/libjxl/libjxl-tiny) contains a simpler encoder implementation of JPEG XL, aimed at photographic images without an alpha channel. The goal is to guide hardware implementations of the encoder where support for the full set of encoding tools is not feasible. The color management is outside the scope of this library, the encoder input is given as a portable float map (PFM) in the linear sRGB colorspace, where individual sample values can be outside the \[0.0, 1.0\] range for out-of-gammut colors. For more details, see the [overview of the coding tools](https://github.com/libjxl/libjxl-tiny/blob/main/doc/coding_tools.md).

The last commit was ten months ago, so it is uncertain whether libjxl-tiny could be considered active.

### Hydrium

[Hydrium](https://github.com/Traneptora/hydrium) is a fast, ultra-low-memory, streaming JPEG XL encoder written in portable C. It is maintained by Traneptora.

### zune-jpegxl

[zune-jpegxl](https://github.com/etemesi254/zune-image/tree/dev/crates/zune-jpegxl) is a simple, fast and fully safe modular JXL encoder written in Rust. It is maintained by etemesi254.

zune-jpegxl has the following features:

- Lossless encoding
- 8 bit and 16 bit support
- Grayscale and RGBA encoding
- Threading capabilities

## Decoders

### jxl-oxide

[jxl-oxide](https://github.com/tirr-c/jxl-oxide) is a spec-conforming JPEG XL decoder written in pure Rust. It is maintained by Wonwoo Choi.

{}

Sources:

- [JXL Wikipedia](https://en.wikipedia.org/wiki/JPEG_XL)
- [JPEGXL.info: Why JXL](https://jpegxl.info/why-jxl.html)
- [Apple JXL Announcement](https://webkit.org/blog/14205/news-from-wwdc23-webkit-features-in-safari-17-beta/#images)
- [JPEG XL: How It Started, How It's Going](https://cloudinary.com/blog/jpeg-xl-how-it-started-how-its-going)
- [The Case for JPEG XL](https://cloudinary.com/blog/the-case-for-jpeg-xl)
- [Time for Next-Gen Codecs to Dethrone JPEG](https://cloudinary.com/blog/time_for_next_gen_codecs_to_dethrone_jpeg)
- [Image Codec Comparison](https://giannirosato.com/blog/post/image-comparison/)
