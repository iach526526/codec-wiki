---
title: JPEG-XL
sidebar_position: 7
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

### JPEG-XL

JPEG-XL（JXL）是一種圖像壓縮格式，由聯合攝影專家組（JPEG）於2020年開發。它旨在提供比傳統的 [JPEG](./JPEG.mdx) 格式更高的壓縮效率，同時保持圖像品質。JPEG-XL 結合了感知色彩編碼、高級熵編碼以及一種新的圖像預測方法來實現其改進的壓縮性能。它還具有無損 JPEG 重新壓縮模式，允許將現有的 JPEG 檔案轉換為 JXL 檔案，從而可以解碼為與原始 JPEG 完全相同的位元組副本。

## 性能檢查

- **無損？** *是*
- **有損？** *是*
- **支援的位元深度：*
  *最高 32 位元深*
- **HDR/廣色域？** *是*
- **動畫？** *是*
- **透明度？** *是*
- **漸進解碼？** *是*
- **免買斷式授權？** *是*

## 格式特點

JPEG-XL 擁有多項突出特點，使其在許多應用場景中成為一個具有吸引力的圖像編解碼器。根據 [JPEG-XL Info page](https://jpegxl.info) 的介紹，JXL 擁有以下特點：

- **最佳無損圖像壓縮**：提供比 PNG 小約35%的檔案大小（對於 HDR 小約50%）。
- **高保真有損圖像壓縮**：JPEG-XL 在保持相同視覺品質的情況下，比 JPEG 小約60%的檔案大小。
- **漸進解碼**：允許在整個檔案下載完成之前以較低的品質顯示圖像，改善慢速連接下的用戶體驗。
- **無損 JPEG 轉碼**：JPEG 圖像可以無損地轉換為 JPEG-XL，且結果檔案約小20%。
- **設計適用於攝影及合成圖像**：JPEG-XL 能夠良好處理各類圖像，包括照片、圖形和插圖。
- **快速的軟體編碼和解碼**：該編解碼器設計為高效且快速，支援快速的圖像加載和保存。
- **全面支援廣色域和 HDR**：JPEG-XL 支援廣泛的顏色和高動態範圍，使其適用於現代顯示器。
- **感知優化的參考編碼器**：編碼器設計為根據人類對圖像的感知來優化圖像品質。

### 無損壓縮

JPEG-XL 提供了出色的無損壓縮能力。雖然無損 WebP 在 8 位無損圖像編碼方面比 PNG 有所改進，但 JPEG-XL 不僅在編碼效率上超越了無損 WebP，還在超過 8 位的位元深度（這是 PNG 先前主導的範疇）中更具多樣性。16 位的無損圖像，尤其是那些越來越受歡迎且少使用 8 位顏色深度的 HDR 圖像，是 JPEG-XL 的強項。它是唯一能在這方面與 PNG 競爭並提供更好編碼效率的編解碼器。

範例：JPEG-XL 對 [這個 16 位 AdobeRGB PNG](https://imgsaver.com/images/2023/10/03/16bit.png) 的壓縮效果優於 PNG。使用指令：`cjxl 16bit.png 16bit.jxl -d 0.0 -e 9 -I 100 -g 3 -E 11`

16 位 PNG：`1533373` 位元組。
16 位 JXL：`1211029` 位元組。

### 有損壓縮

JPEG-XL 在有損壓縮方面也非常擅長，尤其是在我們人類關心的品質水平上。它的壓縮效果比 JPEG 好約 60%。雖然基於影片的編解碼器如 AVIF 在給予大量 CPU 時間的情況下可以具有競爭力，但 JPEG-XL 在中高保真度的攝影圖像中既快速又高效。

### 支援的位元深度

JPEG-XL 支援高達 32 位元每通道的位元深度，使其未來可以應對智能手機中越來越受歡迎的 HDR 照片。相對於編碼結果的大小，使用 JXL 編碼高位深圖像幾乎沒有缺點。考慮到許多智能手機現在拍攝 HDR 照片，JXL 為這些照片未來進入網絡提供了一個引人注目的管道，尤其是 Adobe 和 Apple 等公司已經擁抱了這一新編解碼器。

### 漸進解碼

JPEG-XL 提供了實際的漸進解碼支援，你可以在支援的瀏覽器上進行實驗，如 Safari、Waterfox、Thorium、Mercury 或任何 iOS 上的瀏覽器。

漸進解碼是一項只有 JPEG 能夠實現真正實施的功能，它能夠在整個圖像傳送完成之前渲染低頻變換係數，允許圖像在網絡傳送過程中顯示出來。Blurhashes 並不取代這項技術，而是補充它，提供另一層漸進解碼，可以在圖像開始逐步加載之前使用。這是改善大型圖像網站或在網絡連接不強的情況下提高用戶體驗的重要功能。

### 無損 JPEG 重新壓縮

JPEG-XL 的一個非常獨特的功能是無損 JPEG 重新壓縮，即能夠將 JPEG 輸入轉換為更小檔案大小（平均小 20%）且像素逐一相同的輸出。這也是為什麼像 Meta 這樣的公司支援 JPEG-XL，因為它為互聯網上的現有 JPEG 提供了一條前進的道路。

### 行業支援

根據 JPEG-XL 維基百科頁面：

> 除了最初的 Cloudinary 和 Google 外，在 JPEG-XL 初步實施於網頁瀏覽器期間，許多知名行業品牌的代表公開表示支援 JPEG-XL 作為他們的首選，包括 Facebook、Adobe、Intel 和影片電子標準協會、The Guardian、Flickr 和 SmugMug、Shopify、Krita Foundation 和 Serif Ltd。

Apple 也在 iOS 17 和 macOS Sonoma 中全面支援 JPEG-XL。

### 其他特點

JPEG-XL 擁有廣泛的功能集，具有取代 TIFF 等流行格式的潛力，用於創作工作流程。根據 JXL 維基百科的一些附加特性包括：

### JPEG-XL 的其他特點

- 支援超過十億（2^30-1）像素的圖像尺寸。
- 支援多達 4099 個通道，包括 alpha 透明度。
- 可以包含多個持續時間為零的幀，支援圖形軟件中的圖層。
- 動畫支援，使 JXL 能夠與 GIF 競爭。
- 圖像可以以塊的形式儲存，減少解碼所需的時間。
- 寬泛的位元率範圍內的優雅品質降級，意味著品質損失不像舊格式那樣突然。
- 感知優化的參考編碼器，使用感知色彩空間、自適應量化和保守的默認設定。
- 支援廣色域和 HDR。
- 高效的編碼和解碼，不需要專門的硬件：JPEG XL 的編碼和解碼速度與舊的 JPEG 使用 libjpeg-turbo 相當，並且比 HEIC 使用 x265 更快一個數量級。它也支援並行處理。
- 無買斷式授權，在 GitHub 上有開源。

## 編碼器

JPEG-XL 目前有幾個值得注意的編碼器可供使用。由於 JPEG-XL 是一個新格式，大多數編碼器還未完全發揮出格式的全部潛力。以下是 Jon Sneyers 在 JPEG-XL Discord 中的一段話，總結了目前的情況：

> 編碼方面：編碼器大約使用了 80% 的編碼工具（20% 是 splines 和超大 VarDCT 區塊，以及沒有使用特殊實驗選項的工具，如 delta palette 和 noise）。但所使用的編碼工具，通常是以特定、有限的方式使用，並未充分發揮位流的表達能力。

Sneyers 提到的是 libjxl 的 `cjxl` 編碼器，下面將進一步討論。

### libjxl

[libjxl](https://github.com/libjxl/libjxl) 是 JPEG-XL 的參考實現，具備解碼和編碼 JPEG-XL 圖像檔案的能力。以下是對這些功能的詳細討論。

<Tabs>
    <TabItem value="enc" label="編碼" default>
        
        libjxl 的編碼工具 `cjxl` 提供了豐富的選項供你調整。主要參數包括距離（`-d`）、品質（`-q`）和編碼效率（`-e`）。

        **距離和品質**

        距離和品質這兩個參數決定了*圖像損失的程度*，它們的功能是互相排斥的，因為它們在底層操作時會調整相同的編碼設定。
        * 距離主要用來表示當觀察者靠近圖片時，察覺到壓縮失真的難易度。範圍從 0.0 到 25.0。0.0 表示**數學上的無損**，即每個像素的數值完全與原圖相同。1.0 表示**視覺上的無損**，即在正常觀察距離下看起來與原圖無異，而更高的數值則代表更大的壓縮損失。
        * 品質則類似於 [JPEG](./JPEG.mdx) 的品質參數。範圍從 0 到 100，其中 100 表示**數學上的無損**，90 被設計為**視覺無損**，0 則顯得幾乎無法辨識為原圖。

        **編碼效率**

        編碼效率類似於影片編碼中的 `cpu-used` 參數。這個參數決定了編碼器在追求最小檔案大小時所投入的運算資源。範圍從 1 到 9，數值越高表示編碼器會耗費更多的資源來達到更小的檔案大小，但回報遞減；數值越低則表示放棄部分檔案壓縮率來加快編碼速度。

        ```bash title="以最高效率和距離 1.0 進行編碼"
        cjxl -e 9 -d 1.0 example.png example.jxl
        ```

        ```bash title="此命令默認使用無損 JPEG 壓縮。"
        cjxl example.jpg example.jxl
        ```

    </TabItem>
    <TabItem value="dec" label="解碼">
        使用 libjxl 的解碼器 `djxl` 解碼 `.jxl` 圖像非常簡單：

        ```bash
        djxl example.jxl example.png
        ```
        `djxl` 可以將圖像解碼成像素資料，或者解碼為 png、apng（適用於動畫 jxl）、jpg、ppm 和 pfm 格式。

        默認情況下，如果 `.jxl` 檔案是通過無損 jpeg 重新壓縮的，`djxl` 將還原原始的 jpeg 檔案。若想避免這樣做，並生成一個新的 jpeg 檔案：
        ```bash
        djxl -j example.jxl example.jpg
        ```
        **請注意，這會變成一個有損過程，因為 `djxl` 將解碼為像素，再將這些像素編碼為新的 `.jpg` 檔案。**
    </TabItem>
    <TabItem value="build" label="構建">
        libjxl 在 GitHub repo 提供了完整的構建指南 [libjxl 構建指令](https://github.com/libjxl/libjxl/blob/main/

BUILDING.md)。這裡的指南簡化了內容，僅聚焦於構建一個功能完整且高效的編碼器和解碼器。

        這些指令適用於 macOS 和 Linux，儘管不保證完全支援 macOS。

        ```bash title="1. 克隆儲存庫"
        git clone https://github.com/libjxl/libjxl.git --recursive --shallow-submodules
        ```

        ```bash title="2. 安裝依賴項，可能需要以 root 權限執行這些命令"
        apt install cmake pkg-config libbrotli-dev clang # Debian Linux
        pacman -Syu cmake pkgconf brotli clang # Arch Linux
        brew install cmake pkg-config brotli # macOS
        ```

        ```bash title="3. 在構建前設定 CC 和 CXX 變數（建議）"
        export CC=clang CXX=clang++
        ```

        ```bash title="4. cjxl 和 djxl 將位於 build/tools 目錄中。"
        cd libjxl && mkdir build && cd build
        cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS="-O3 -march=native" -DCMAKE_C_FLAGS="-O3 -march=native" -DBUILD_TESTING=OFF -DJPEGXL_WARNINGS_AS_ERRORS=OFF -DJPEGXL_ENABLE_SJPEG=OFF ..
        cmake --build . -- -j$(nproc)
        ```

        這樣做將在 Linux 或 macOS 上，以 O3 優化方式針對你的 CPU 架構構建 `cjxl` 和 `djxl`。再次提醒，macOS 支援並非重點。根據 libjxl 的 OS X 構建指南：

        > OS X 的構建是「盡力而為」的支援，即構建可能無法順利進行，有些測試可能會失敗，某些子項目可能會被排除在構建之外。
    </TabItem>
</Tabs>

### libjxl-tiny

[libjxl-tiny](https://github.com/libjxl/libjxl-tiny) contains a simpler encoder implementation of JPEG XL, aimed at photographic images without an alpha channel. The goal is to guide hardware implementations of the encoder where support for the full set of encoding tools is not feasible. The color management is outside the scope of this library, the encoder input is given as a portable float map (PFM) in the linear sRGB colorspace, where individual sample values can be outside the \[0.0, 1.0\] range for out-of-gammut colors. For more details, see the [overview of the coding tools](https://github.com/libjxl/libjxl-tiny/blob/main/doc/coding_tools.md).

The last commit was ten months ago, so it is uncertain whether libjxl-tiny could be considered active.

### Hydrium

[Hydrium](https://github.com/Traneptora/hydrium) is a fast, ultra-low-memory, streaming JPEG XL encoder written in portable C. It is maintained by Traneptora.

### zune-jpegxl

[zune-jpegxl](https://github.com/etemesi254/zune-image/tree/dev/crates/zune-jpegxl) is a simple, fast and fully safe modular JXL encoder written in Rust. It is maintained by etemesi254.

zune-jpegxl has the following features:

- Lossless encoding
- 8 bit and 16 bit support
- Grayscale and RGBA encoding
- Threading capabilities

## Decoders

### jxl-oxide

[jxl-oxide](https://github.com/tirr-c/jxl-oxide) is a spec-conforming JPEG XL decoder written in pure Rust. It is maintained by Wonwoo Choi.

{}

Sources:

- [JXL Wikipedia](https://en.wikipedia.org/wiki/JPEG_XL)
- [JPEGXL.info: Why JXL](https://jpegxl.info/why-jxl.html)
- [Apple JXL Announcement](https://webkit.org/blog/14205/news-from-wwdc23-webkit-features-in-safari-17-beta/#images)
- [JPEG XL: How It Started, How It's Going](https://cloudinary.com/blog/jpeg-xl-how-it-started-how-its-going)
- [The Case for JPEG XL](https://cloudinary.com/blog/the-case-for-jpeg-xl)
- [Time for Next-Gen Codecs to Dethrone JPEG](https://cloudinary.com/blog/time_for_next_gen_codecs_to_dethrone_jpeg)
- [Image Codec Comparison](https://giannirosato.com/blog/post/image-comparison/)
